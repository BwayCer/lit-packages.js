import e from"events";import{noChange as t}from"lit";import{directive as l,AsyncDirective as i}from"lit/async-directive.js";import{unsafeHTML as a}from"lit/directives/unsafe-html.js";function s(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,n(e,t,"get"))}function r(e,t,l){return function(e,t,l){if(t.set)t.set.call(e,l);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=l}}(e,n(e,t,"set"),l),l}function n(e,t,l){if(!t.has(e))throw new TypeError("attempted to "+l+" private field on non-instance");return t.get(e)}function h(e,t,l){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return l}function o(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u(e,t,l){o(e,t),t.set(e,l)}function c(e,t){o(e,t),t.add(e)}const d={chainIdNotExist:'The chainId "{{chainId}}" is not exist.',modelValueTypeNotExpected:'The model value type is not accepted. (actually: <{{type}}> "{{value}}")'};var p=new WeakMap,f=new WeakMap,y=new WeakSet;class m{constructor(e){c(this,y),u(this,p,{writable:!0,value:void 0}),u(this,f,{writable:!0,value:!1}),r(this,p,e),r(this,f,"string"==typeof e&&!!~e.indexOf("{{"))}get value(){return s(this,p)}get isNA(){return void 0===s(this,p)}getValue(e=null){if(this.isNA)return"N/A";if("function"==typeof e)return e(this);let t=s(this,p);return s(this,f)&&null!==e&&"object"==typeof e&&(t=h(this,y,b).call(this,t,e)),t}}function b(e,t){return Object.entries(t).reduce(((e,[t,l])=>e.replaceAll(`{{${t}}}`,l)),e)}var w=new WeakSet,v=new WeakSet,k=new WeakSet,g=new WeakSet,V=new WeakMap,A=new WeakSet,N=new WeakSet,W=new WeakSet;class j extends e{constructor(e=null){super(),c(this,W),c(this,N),c(this,A),c(this,g),c(this,k),c(this,v),c(this,w),u(this,V,{writable:!0,value:/^([^\[\]]+[^\[\].])(?:\[(\d+)\])?$/}),this._modelMap=new Map,"object"===h(this,w,x).call(this,e).name&&h(this,g,E).call(this,e,"",this._modelMap)}createData(e,t){"string"==typeof e&&""!==e&&(this.delete(e),h(this,g,E).call(this,t,e,this._modelMap))}set(e,t=null){let{ok:l,chainId:i,oldValue:a,oldValueType:s,valueType:r,isQuerryArray:n,index:o}=h(this,N,S).call(this,e,t);if(!l)return;if(!n&&"array"===s!==("array"===r))return;let u=this._modelMap,c=t;return n?(c=a,a[o]=t,h(this,W,I).call(this,e,t)):u.set(i,c),h(this,W,I).call(this,i,c),t}setArray(e){let{ok:t,oldValue:l,oldValueType:i,isQuerryArray:a}=h(this,N,S).call(this,e,null);if(t&&!a&&"array"===i)return setTimeout((t=>{let l=h(this,k,M).call(this,t);this._modelMap.set(e,l),h(this,W,I).call(this,e,l)}),0,l),l}get(e,t){let{ok:l,oldValue:i,oldValueType:a,isQuerryArray:s,index:r}=h(this,N,S).call(this,e);if(!l)return"N/A";let n=s?i[r]:"array"===a?h(this,k,M).call(this,i):i;return new m(n).getValue(t)}delete(e,t=!1){let l=this._modelMap;l.has(e)&&(l.delete(e),h(this,W,I).call(this,e));for(let t of l.keys())t.startsWith(e)&&(l.delete(t),h(this,W,I).call(this,e));t&&this.deleteAllListeners(e)}deleteAllListeners(e){let t=_.eventNames();for(let l of t)l.startsWith(e)&&_.removeAllListeners(l)}clear(){this._modelMap.clear(),this.removeAllListeners()}}function x(e){let t="",l=1;switch(null==e?e:e.constructor){case void 0:t="undefined",l=0;break;case null:t="null",l=0;break;case String:t="string";break;case Number:t=isNaN(e)?"null":"number";break;case Boolean:t="boolean";break;case Array:t="array",l=2;break;case Object:t="object",l=3;break;default:t="other",l=4}return{name:t,state:l}}function T(e,t){switch(h(this,w,x).call(this,e).name){case"array":e.forEach((e=>h(this,v,T).call(this,e,t)));break;case"object":Object.values(e).forEach((e=>h(this,v,T).call(this,e,t)));break;case"other":throw new Error(d.modelValueTypeNotExpected.replaceAll("{{type}}","array").replaceAll("{{value}}",JSON.stringify(e)))}}function M(e){return JSON.parse(JSON.stringify(e))}function E(e,t,l){switch(h(this,w,x).call(this,e).name){case"undefined":case"null":l.set(t,null),h(this,W,I).call(this,t,null);break;case"string":case"number":case"boolean":l.set(t,e),h(this,W,I).call(this,t,e);break;case"array":let i=h(this,k,M).call(this,e);l.set(t,i),h(this,W,I).call(this,t,i);break;case"object":Object.entries(e).forEach((e=>h(this,g,E).call(this,e[1],t+"."+e[0],l)))}return l}function O(e){let t=e.match(s(this,V)),l=null!==t,i=l?t[2]:void 0,a=void 0!==i;return{ok:l,isArray:a,chainId:l?t[1]:"",index:a?parseInt(i):-1}}function S(e,t=null){let l="null";null!==t&&(h(this,v,T).call(this,t),l=h(this,w,x).call(this,t).name);let{ok:i,chainId:a,isArray:s,index:r}=h(this,A,O).call(this,e),n=this._modelMap;if(i&&n.has(a)){let e=n.get(a),i=h(this,w,x).call(this,e).name;if(!s||"array"===i){let n=t;if(s)switch(l){case"array":case"object":n=h(this,k,M).call(this,t)}return{ok:!0,chainId:a,oldValue:e,oldValueType:i,value:n,valueType:l,isQuerryArray:s,index:r}}}return console.error(new Error(d.chainIdNotExist.replaceAll("{{chainId}}",e))),{ok:!1}}async function I(e,t){this.emit(e,new m(t))}const _=new j;var L=new WeakMap,Q=new WeakMap,J=new WeakSet;class U extends i{constructor(e){var t,l,i;super(e),c(this,J),u(this,L,{writable:!0,value:""}),u(this,Q,{writable:!0,value:null}),i=e=>{super.setValue(e.isNA?"N/A":this.updateValue(e,s(this,Q)))},(l="setValue")in(t=this)?Object.defineProperty(t,l,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[l]=i,_.on(s(this,L),this.setValue)}reconnected(){_.on(s(this,L),this.setValue)}disconnected(){_.removeListener(s(this,L),this.setValue)}update(e,[l,i=null]){let a=!1;if(s(this,L)!==l){a=!0;let e=this.setValue;_.removeListener(s(this,L),e),_.on(l,e),r(this,L,l)}let{isUpdate:n,handleOption:o}=h(this,J,$).call(this,i);return n&&r(this,Q,o),a||n?this.render(l,o):t}render(e,t=null){return _.get(e,t)}updateValue(e,t){return e.getValue(t)}}function $(e=null){if("function"==typeof e)return{isUpdate:!0,handleOption:e};let t=!1,l={...e},i=Object.keys(l);0===i.length&&(t=!0,l=null);let a=s(this,Q),r=null===a,n=t!==r;if(!t&&!r&&(n=!0,i.length===a.length)){let e=!1;for(let t of i)if(l[t]!==a[t]){e=!0;break}n=e}return{isUpdate:n,handleOption:l}}class z extends U{render(e,t=null){let l=super.render(e,t);return"symbol"==typeof l?l:a(l)}updateValue(e,t){let l=super.updateValue(e,t);return"symbol"==typeof l?l:a(l)}}const B=l(U),C=l(z);export{U as LitViewModelDirective,z as LitViewModelUnsafeHTMLDirective,m as ModelValue,j as ViewModel,B as litViewModel,C as litViewModelUnsafeHTML,_ as viewModel};
